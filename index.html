<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu Kaboom - Projectile Sprite</title>
    <script src="https://unpkg.com/kaboom/dist/kaboom.js"></script>
</head>
<body>
<script>
kaboom({
    width: window.innerWidth,
    height: window.innerHeight,
    background: [20, 20, 40],
});

// --- SPRITES ---
// Héros
loadSprite("hero", "https://raw.githubusercontent.com/jijoxP/portfolioV1/refs/heads/main/assets/hero.png", {
    sliceX: 10,
    anims: {
        run2: { from: 6, to: 9, speed: 30, loop: true },
        run: { from: 2, to: 5, speed: 30, loop: true },
        walk2: { from: 6, to: 9, speed: 10, loop: true },
        walk : { from: 2, to: 5, speed: 10, loop: true },
        idle: { from: 0, to: 1, speed: 3, loop: true },
    }
});

// Portfolio
loadSprite("portfolioSprite", "https://raw.githubusercontent.com/jijoxP/portfolioV1/refs/heads/main/portfolio%20spriteFerm%C3%A9.png");

loadSprite("bullet", "https://raw.githubusercontent.com/jijoxP/portfolioV1/refs/heads/main/assets/All_Fire_Bullet_Pixel_16x16_07.png");

setGravity(2000);
const WALK_SPEED = 200;
const RUN_SPEED = 400;

scene("main", () => {
    // Sol
    add([
        rect(width(), 48),
        pos(0, height() - 48),
        color(100,0,150),
        area(),
        body({ isStatic: true })
    ]);

    // Joueur
    const player = add([
        sprite("hero"),
        pos(100, 400),
        area(),
        body(),
        scale(1.5)
    ]);
    player.play("idle");

    let moveDir = 0;
    let canMove = true;

    onKeyDown("left", () => { if(canMove) moveDir = -1; });
    onKeyDown("right", () => { if(canMove) moveDir = 1; });
    onKeyRelease("left", () => { if(moveDir === -1) moveDir = 0; });
    onKeyRelease("right", () => { if(moveDir === 1) moveDir = 0; });

    onKeyPress("space", () => { if(player.isGrounded() && canMove) player.jump(1000); });

    // --- Projectile avec sprite (flèche ↑) ---
    onKeyPress("up", () => {
        const dir = moveDir >= 0 ? 1 : -1;
        const projectile = add([
            sprite("bullet"),
            pos(player.pos.x + (dir * 20), player.pos.y + 10),
            scale(2), // ajuste la taille
            area(),
            "projectile"
        ]);

        // Déplacement du projectile
        onUpdate(() => {
            if(projectile.pos){
                projectile.move(dir * 600, 0);
            }
        });

        // Auto-destruction après 2s
        wait(2, () => destroy(projectile));
    });

    // Marche / Course
    player.onUpdate(() => {
        let speed = isKeyDown("shift") ? RUN_SPEED : WALK_SPEED;
        player.move(moveDir * speed, 0);

        if(moveDir === 1 && player.curAnim() !== "walk") player.play("walk");
        else if(moveDir === -1 && player.curAnim() !== "walk2") player.play("walk2");
        else if(moveDir === 0 && player.isGrounded() && player.curAnim() !== "idle") player.play("idle");
    });

    onUpdate(() => camPos(player.pos));
});

go("main");
</script>
</body>
</html>
