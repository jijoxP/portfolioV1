<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu Kaboom - Plateforme mobile vers shop</title>
    <script src="https://unpkg.com/kaboom/dist/kaboom.js"></script>
</head>
<body>
<script>
kaboom({
    width: window.innerWidth,
    height: window.innerHeight,
    background: [20, 20, 40],
});

loadSprite("hero", "https://raw.githubusercontent.com/jijoxP/portfolioV1/refs/heads/main/assets/hero.png", {
    sliceX: 10,
    anims: {
        run2: { from: 6, to: 9, speed: 10, loop: true },
        run: { from: 2, to: 5, speed: 10, loop: true },
        idle: { from: 0, to: 1, speed: 3, loop: true },
    }
});

// --- Sprite animé du shop (remplacez par le vrai sprite du shop Oak Woods) ---
loadSprite("shop", "https://raw.githubusercontent.com/jijoxP/portfolioV1/refs/heads/main/assets/shop_anim.png", {
    sliceX: 4, // nombre de frames horizontales
    anims: {
        open: { from: 0, to: 3, speed: 4, loop: false } // vitesse naturelle, ne boucle pas
    }
});

setGravity(2000);
const SPEED = 200;

scene("main", () => {

    // Sol
    add([
        rect(width(), 48),
        pos(0, height() - 48),
        color(100,0,150),
        area(),
        body({ isStatic: true })
    ]);

    // Joueur
    const player = add([
        sprite("hero"),
        pos(100, 400),
        area(),
        body(),
        scale(1.5)
    ]);
    player.play("idle");

    // Plateforme fixe sous le shop
    const fixedPlatform = add([
        rect(200, 20),
        pos(500, 400),
        color(0,0,255),
        area(),
        body({ isStatic: true })
    ]);

    // --- Shop animé sur la plateforme fixe ---
    const shopButton = add([
        sprite("shop"),
        pos(fixedPlatform.pos.x + 50, fixedPlatform.pos.y - 64),
        area(),
        scale(2),
        "interactive"
    ]);
    shopButton.play("open"); // animation qui se joue normalement

    add([
        text("Shop",{ size:16 }),
        pos(shopButton.pos.x, shopButton.pos.y - 30),
        color(255,255,255)
    ]);

    // Plateforme mobile
    const movingPlatform = add([
        rect(200, 20),
        pos(150, 550),
        color(150, 75, 0),
        area(),
        body({ isStatic: true }),
        "platform"
    ]);

    let dir = 1;
    const platformSpeed = 1000;

    onUpdate(() => {
        movingPlatform.move(platformSpeed * dir * dt(), 0);
        if(movingPlatform.pos.x < 100) dir = 1;
        if(movingPlatform.pos.x > 400) dir = -1;
    });

    // Déplacements du joueur
    let moveDir = 0;
    onKeyDown("left", () => moveDir = -1);
    onKeyDown("right", () => moveDir = 1);
    onKeyRelease("left", () => { if(moveDir === -1) moveDir = 0; });
    onKeyRelease("right", () => { if(moveDir === 1) moveDir = 0; });

    onKeyPress("space", () => { if(player.isGrounded()) player.jump(SPEED*5 ); });

    player.onUpdate(() => {
        player.move(moveDir*200,0);
        if(moveDir === 1 && player.curAnim() !== "run") player.play("run");
        else if(moveDir === -1 && player.curAnim() !== "run2") player.play("run2");
        else if(moveDir === 0 && player.isGrounded() && player.curAnim() !== "idle") player.play("idle");
    });

    player.onGround(() => shake(4));
    onUpdate(() => camPos(player.pos));

    // Interaction avec le shop
    player.onCollide("interactive", () => go("portfolio"));
});

// --- SCÈNE PORTFOLIO ---
scene("portfolio", () => {
    add([
        text("Bienvenue dans la scène Portfolio !", { size: 32 }),
        pos(center()),
        anchor("center"),
        color(255,255,0)
    ]);
    add([
        text("Appuyez sur Echap pour revenir", { size: 16 }),
        pos(center().x, center().y + 60),
        anchor("center"),
        color(255,255,255)
    ]);

    onKeyPress("escape", () => go("main"));
});

go("main");
</script>
</body>
</html>
